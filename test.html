


<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau Interactif - Gestion des Paiements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* STYLES EXISTANTS */
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .table-responsive table { width: 100%; border-collapse: collapse; min-width: 800px; }
        .table-responsive th, .table-responsive td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; white-space: nowrap; }
        .card-view { display: none; }
        @media (max-width: 359px) {
            .table-responsive table { display: none !important; }
            .card-view { display: grid !important; grid-template-columns: 1fr; gap: 8px; padding: 8px; background: #f8fafc; }
        }
        @media (min-width: 360px) and (max-width: 600px) {
            .table-responsive table { display: none !important; }
            .card-view { display: grid !important; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 12px; background: #f8fafc; }
        }
        @media (min-width: 601px) and (max-width: 959px) {
            .table-responsive table { display: none !important; }
            .card-view { display: grid !important; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 16px; background: #f8fafc; }
        }
        @media (min-width: 960px) {
            .table-responsive table { display: table !important; }
            .card-view { display: none !important; }
        }
        .payment-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            height: fit-content;
        }
        .payment-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); border-color: #3b82f6; }
        .payment-card.expanded { transform: none; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15); border-color: #1d4ed8; }
        .card-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: flex-start; position: relative; min-height: 120px; }
        .card-id { position: absolute; top: 12px; right: 16px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); z-index: 10; }
        .card-main-info { flex: 1; padding-right: 60px; }
        .card-user-name { font-size: 16px; font-weight: 600; color: #1e40af; margin-bottom: 4px; line-height: 1.2; word-break: break-word; }
        .card-amount { font-size: 20px; font-weight: bold; color: #059669; margin-bottom: 8px; }
        .card-status { display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        .expand-indicator { position: absolute; bottom: 8px; right: 16px; width: 24px; height: 24px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; color: #64748b; font-size: 12px; }
        .payment-card.expanded .expand-indicator { transform: rotate(180deg); background: #3b82f6; color: white; }
        .card-details { max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; background: rgba(248, 250, 252, 0.5); border-top: 1px solid #e2e8f0; }
        .payment-card.expanded .card-details { max-height: 500px; padding: 20px; }
        .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { font-size: 13px; color: #6b7280; font-weight: 500; display: flex; align-items: center; flex: 1; }
        .detail-label i { margin-right: 8px; width: 16px; text-align: center; }
        .detail-value { font-size: 14px; color: #374151; font-weight: 600; text-align: right; max-width: 60%; word-break: break-word; }
        .detail-value.code { font-family: 'Courier New', monospace; font-size: 11px; background: white; padding: 4px 8px; border-radius: 4px; border: 1px solid #dbeafe; color: #1e40af; }
        .status-initialise { background-color: #fef3c7; color: #d97706; }
        .status-valide { background-color: #d1fae5; color: #065f46; }
        .status-echoue { background-color: #fee2e2; color: #dc2626; }
        
        /* Styles pour le formulaire */
        .form-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        .form-container.open {
            max-height: 500px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        
        /* Styles pour les boutons désactivés */
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Media Queries pour les boutons responsives */
        .buttons-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .left-buttons, .right-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        
        .action-button i {
            margin-right: 6px;
        }
        
        /* Écrans très petits (≤400px) */
        @media (max-width: 400px) {
            .buttons-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .left-buttons, .right-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .left-buttons {
                margin-bottom: 12px;
            }
            
            .action-button {
                flex: 1;
                min-width: 120px;
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .page-title {
                text-align: center;
                margin: 16px 0;
                order: -1;
            }
        }
        
        /* Écrans petits (401px à 930px) */
        @media (min-width: 401px) and (max-width: 930px) {
            .buttons-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .left-buttons, .right-buttons {
                width: 100%;
                justify-content: center;
                margin-bottom: 12px;
            }
            
            .action-button {
                flex: 1;
                min-width: 140px;
                padding: 10px 16px;
            }
            
            .page-title {
                text-align: center;
                margin: 16px 0;
                order: -1;
            }
        }
        
        /* Écrans moyens (931px à 1023px) */
        @media (min-width: 931px) and (max-width: 1023px) {
            .buttons-container {
                flex-direction: row;
                align-items: center;
            }
            
            .left-buttons, .right-buttons {
                flex: 1;
            }
            
            .right-buttons {
                justify-content: flex-end;
            }
            
            .action-button {
                padding: 10px 16px;
            }
            
            .page-title {
                text-align: center;
                flex: 2;
                margin: 0 16px;
            }
        }
        
        /* Écrans larges (1024px à 1280px) */
        @media (min-width: 1024px) and (max-width: 1280px) {
            .buttons-container {
                flex-direction: row;
                align-items: center;
            }
            
            .left-buttons, .right-buttons {
                flex: 1;
            }
            
            .right-buttons {
                justify-content: flex-end;
            }
            
            .action-button {
                padding: 10px 20px;
            }
            
            .page-title {
                text-align: center;
                flex: 2;
                margin: 0 20px;
            }
        }
        
        /* Écrans très larges (≥1281px) */
        @media (min-width: 1281px) {
            .buttons-container {
                flex-direction: row;
                align-items: center;
            }
            
            .left-buttons, .right-buttons {
                flex: 1;
            }
            
            .right-buttons {
                justify-content: flex-end;
            }
            
            .action-button {
                padding: 12px 24px;
            }
            
            .page-title {
                text-align: center;
                flex: 2;
                margin: 0 24px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen bg-gray-50 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Conteneur des boutons avec structure responsive -->
            <div class="buttons-container">
                <!-- Boutons de gauche -->
                <div class="left-buttons">
                    <button id="btnModify" class="action-button bg-gray-400 btn-disabled text-white">
                        <i class="fas fa-edit"></i> Modifier
                    </button>
                    <button id="btnDelete" class="action-button bg-red-500 btn-disabled text-white">
                        <i class="fas fa-trash"></i> Supprimer
                    </button>
                    <button id="toggleForm" class="action-button bg-blue-500 hover:bg-blue-600 text-white">
                        <i class="fas fa-plus"></i> Nouveau Paiement
                    </button>
                </div>
                
                <!-- Titre -->
                <h1 class="page-title text-2xl font-bold text-gray-900">Gestion des Paiements</h1>
                
                <!-- Boutons de droite -->
                <div class="right-buttons">
                    <button class="action-button bg-gray-300 hover:bg-gray-400 text-gray-800">
                        <i class="fas fa-download"></i> Exporter
                    </button>
                    <button class="action-button bg-gray-300 hover:bg-gray-400 text-gray-800">
                        <i class="fas fa-print"></i> Imprimer
                    </button>
                    <button class="action-button bg-gray-300 hover:bg-gray-400 text-gray-800">
                        <i class="fas fa-cog"></i> Options
                    </button>
                </div>
            </div>
            
            <!-- Formulaire d'ajout -->
            <div id="formContainer" class="form-container bg-white rounded-lg shadow-sm border mb-8">
                <div class="p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4" id="formTitle">Ajouter un nouveau paiement</h2>
                    <form id="paymentForm" class="form-grid">
                        <input type="hidden" id="editId" name="editId" value="">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ID KirooWorld</label>
                            <input type="text" name="idKw" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nom & Prénom</label>
                            <input type="text" name="user_name" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pack</label>
                            <select name="pack" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                <option value="">Sélectionner un pack</option>
                                <option value="Dieu du Mboa">Dieu du Mboa</option>
                                <option value="Pack Premium">Pack Premium</option>
                                <option value="Pack Starter">Pack Starter</option>
                                <option value="Pack Business">Pack Business</option>
                                <option value="Pack Basic">Pack Basic</option>
                                <option value="Pack VIP">Pack VIP</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Montant ($)</label>
                            <input type="number" step="0.01" name="amount" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Système de paiement</label>
                            <select name="payment_system" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                <option value="">Sélectionner un mode</option>
                                <option value="Mobile Money">Mobile Money</option>
                                <option value="Orange Money">Orange Money</option>
                                <option value="MTN Money">MTN Money</option>
                                <option value="PayPal">PayPal</option>
                                <option value="Express Union">Express Union</option>
                                <option value="Virement Bancaire">Virement Bancaire</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Statut</label>
                            <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                <option value="">Sélectionner un statut</option>
                                <option value="Initialisé">Initialisé</option>
                                <option value="Validé">Validé</option>
                                <option value="Échoué">Échoué</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Code Facture</label>
                            <input type="text" name="invoice_code" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" name="date" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Heure</label>
                            <input type="time" name="time" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div class="flex items-end space-x-2">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md flex-1">
                                <span id="submitText">Ajouter le paiement</span>
                            </button>
                            <button type="button" id="cancelEdit" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md hidden">
                                Annuler
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Le reste du code (table section) reste inchangé -->
            <!-- ... -->
             <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                <!-- Pagination Top -->
                <div class="p-4 border-b flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div class="text-sm text-gray-600">*IRL: In Real Life</div>
                    <div class="flex items-center gap-2">
                        <nav class="flex items-center gap-1">
                            <button class="w-8 h-8 flex items-center justify-center bg-blue-500 text-white rounded text-sm">1</button>
                            <button class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-sm">2</button>
                            <button class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-sm">3</button>
                            <button class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-sm">4</button>
                            <span class="px-2 text-gray-500">...</span>
                            <button class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-sm">454</button>
                            <button class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-sm">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </nav>
                        <div class="flex items-center gap-2 ml-4">
                            <span class="text-sm text-gray-600">Aller à la page</span>
                            <input type="text" class="w-16 px-2 py-1 border border-gray-300 rounded text-sm">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">Go</button>
                        </div>
                    </div>
                </div>

                <!-- Table responsive avec cartes -->
                <div class="table-responsive">
                    <!-- Vue tableau classique (desktop ≥960px) -->
                    <table class="w-full">
                        <thead class="bg-yellow-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">
                                    <input type="checkbox" id="selectAll" class="rounded border-gray-300">
                                </th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ID</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Nom & Prénom Email</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Pack payé</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Montant reçu</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Système paiement</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">
                                    Statut <i class="fas fa-info-circle text-gray-400 ml-1"></i>
                                </th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Référence Code</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date paiement</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200" id="tableBody">
                            <!-- Les données seront ajoutées dynamiquement ici -->
                        </tbody>
                    </table>

                    <!-- Vue cartes (mobile/tablette) -->
                    <div class="card-view" id="cardContainer">
                        <!-- Les cartes seront ajoutées dynamiquement ici -->
                    </div>
                </div>

                <!-- Footer avec pagination -->
                <div class="bg-gray-100 px-6 py-4 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="text-xs sm:text-sm text-gray-700">
                            Affichage de <span class="font-medium">1</span> à <span class="font-medium">6</span> sur <span class="font-medium">12</span> résultats
                        </div>
                        <div class="flex space-x-2">
                            <button class="text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                <i class="fas fa-chevron-left mr-1"></i>
                                Précédent
                            </button>
                            <button class="text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                1
                            </button>
                            <button class="text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                2
                            </button>
                            <button class="text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                Suivant
                                <i class="fas fa-chevron-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Le script JavaScript reste inchangé -->
    <!-- ... -->
     <script>
        // Données initiales
        const paymentData = [
            {
                id: "23134",
                idKw: "KW235553",
                user_name: "Hamilyang Père",
                email: "hamiliangpere44@gmail.com",
                pack: "Dieu du Mboa",
                pack_code: "dieu-du-mboa",
                amount: "$2,000.00",
                payment_system: "Mobile Money",
                status: "Initialisé",
                invoice_code: "RC1520250806J20374",
                date: "6 août 2025",
                time: "12:12"
            },
            {
                id: "23135",
                idKw: "KW235554",
                user_name: "Marie Dupont",
                email: "marie.dupont@email.com",
                pack: "Pack Premium",
                pack_code: "premium",
                amount: "$1,500.00",
                payment_system: "Orange Money",
                status: "Validé",
                invoice_code: "RC1520250806J20375",
                date: "7 août 2025",
                time: "09:30"
            },
            {
                id: "23136",
                idKw: "KW235555",
                user_name: "Jean Martin",
                email: "jean.martin@gmail.com",
                pack: "Pack Starter",
                pack_code: "starter",
                amount: "$500.00",
                payment_system: "MTN Money",
                status: "Échoué",
                invoice_code: "RC1520250806J20376",
                date: "7 août 2025",
                time: "14:45"
            }
        ];

        // Variables globales
        let nextId = 23137; // Prochain ID à utiliser
        let selectedRows = new Set(); // Ensemble des lignes sélectionnées

        // Fonction pour générer le HTML d'une ligne de tableau
        function generateTableRow(data) {
            const statusClass = getStatusClass(data.status);
            const statusIcon = getStatusIcon(data.status);
            
            return `
                <tr class="hover:bg-gray-50 transition-colors" data-id="${data.id}">
                    <td class="px-4 py-4">
                        <input type="checkbox" class="row-checkbox rounded border-gray-300" data-id="${data.id}">
                    </td>
                    <td class="px-4 py-4 text-sm font-medium text-gray-900">${data.id}</td>
                    <td class="px-4 py-4">
                        <div class="text-sm">
                            <div class="text-blue-600 font-semibold">${data.idKw}</div>
                            <div class="text-blue-600 font-medium">${data.user_name}</div>
                            <div class="text-blue-500 text-xs">${data.email}</div>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-sm">
                        <div class="font-medium">${data.pack}</div>
                        <div class="text-gray-500 text-xs">(${data.pack_code})</div>
                    </td>
                    <td class="px-4 py-4 text-sm font-bold text-green-600">${data.amount}</td>
                    <td class="px-4 py-4 text-sm text-gray-500">${data.payment_system}</td>
                    <td class="px-4 py-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${statusClass}">
                            ${statusIcon}
                            ${data.status}
                        </span>
                    </td>
                    <td class="px-4 py-4 text-sm">
                        <div class="text-blue-600">
                            <div class="font-semibold text-xs">Code Facture :</div>
                            <div class="font-mono text-xs">${data.invoice_code}</div>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-sm text-gray-600">
                        <div class="font-medium">${data.date}</div>
                        <div class="text-xs">${data.time}</div>
                    </td>
                </tr>
            `;
        }

        // Fonction pour générer le HTML d'une carte
        function generateCard(data) {
            const statusClass = getStatusClass(data.status);
            const statusIcon = getStatusIcon(data.status);
            
            return `
                <div class="payment-card" data-id="${data.id}">
                    <div class="card-id">#${data.id}</div>
                    <div class="card-header">
                        <div class="card-main-info">
                            <div class="card-user-name">${data.user_name}</div>
                            <div class="card-amount">${data.amount}</div>
                            <span class="card-status ${statusClass}">
                                ${statusIcon}
                                ${data.status}
                            </span>
                        </div>
                        <div class="expand-indicator">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="card-details">
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-user"></i>
                                ID KirooWorld
                            </span>
                            <span class="detail-value">${data.idKw}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </span>
                            <span class="detail-value">${data.email}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-box"></i>
                                Pack
                            </span>
                            <span class="detail-value">${data.pack}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-credit-card"></i>
                                Paiement
                            </span>
                            <span class="detail-value">${data.payment_system}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-receipt"></i>
                                Code Facture
                            </span>
                            <span class="detail-value code">${data.invoice_code}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">
                                <i class="fas fa-calendar"></i>
                                Date
                            </span>
                            <span class="detail-value">${data.date} - ${data.time}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonctions utilitaires
        function getStatusClass(statusText) {
            if (statusText.includes('Initialisé')) return 'bg-yellow-100 text-yellow-800';
            if (statusText.includes('Validé')) return 'bg-green-100 text-green-800';
            if (statusText.includes('Échoué')) return 'bg-red-100 text-red-800';
            return 'bg-yellow-100 text-yellow-800';
        }

        function getStatusIcon(statusText) {
            if (statusText.includes('Initialisé')) return '<i class="fas fa-clock mr-1"></i>';
            if (statusText.includes('Validé')) return '<i class="fas fa-check-circle mr-1"></i>';
            if (statusText.includes('Échoué')) return '<i class="fas fa-times-circle mr-1"></i>';
            return '<i class="fas fa-clock mr-1"></i>';
        }

        // Fonction pour afficher les données
        function renderData() {
            const tableBody = document.getElementById('tableBody');
            const cardContainer = document.getElementById('cardContainer');
            
            tableBody.innerHTML = '';
            cardContainer.innerHTML = '';
            
            paymentData.forEach(data => {
                tableBody.innerHTML += generateTableRow(data);
                cardContainer.innerHTML += generateCard(data);
            });
            
            // Réinitialiser les écouteurs d'événements
            initCardInteractions();
            initCheckboxListeners();
            updateButtonStates();
        }

        // Fonction pour ajouter une nouvelle donnée
        function addPayment(data) {
            // Générer un ID unique
            data.id = nextId.toString();
            nextId++;
            
            // Formater la date
            const dateObj = new Date(data.date);
            data.date = dateObj.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
            
            // Formater le montant
            data.amount = `$${parseFloat(data.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            
            // Ajouter aux données
            paymentData.push(data);
            
            // Réafficher les données
            renderData();
            
            // Fermer le formulaire
            closeForm();
        }

        // Fonction pour mettre à jour une donnée existante
        function updatePayment(data) {
            const id = document.getElementById('editId').value;
            const index = paymentData.findIndex(item => item.id === id);
            
            if (index !== -1) {
                // Formater la date
                const dateObj = new Date(data.date);
                data.date = dateObj.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
                
                // Formater le montant
                data.amount = `$${parseFloat(data.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                
                // Mettre à jour l'objet
                paymentData[index] = { ...paymentData[index], ...data };
                
                // Réafficher les données
                renderData();
                
                // Réinitialiser le formulaire
                cancelEdit();
            }
        }

        // Fonction pour supprimer des données
        function deleteSelectedPayments() {
            if (selectedRows.size === 0) return;
            
            if (confirm(`Êtes-vous sûr de vouloir supprimer ${selectedRows.size} élément(s) ?`)) {
                // Supprimer les éléments sélectionnés
                selectedRows.forEach(id => {
                    const index = paymentData.findIndex(item => item.id === id);
                    if (index !== -1) {
                        paymentData.splice(index, 1);
                    }
                });
                
                // Vider la sélection
                selectedRows.clear();
                
                // Réafficher les données
                renderData();
            }
        }

        // Fonction pour préparer l'édition
        function prepareEdit() {
            if (selectedRows.size !== 1) return;
            
            const id = Array.from(selectedRows)[0];
            const data = paymentData.find(item => item.id === id);
            
            if (data) {
                // Remplir le formulaire avec les données
                document.getElementById('editId').value = data.id;
                document.getElementById('formTitle').textContent = 'Modifier le paiement';
                document.getElementById('submitText').textContent = 'Modifier le paiement';
                document.getElementById('cancelEdit').classList.remove('hidden');
                
                // Convertir la date au format YYYY-MM-DD
                const dateParts = data.date.split(' ');
                const months = {
                    'janvier': '01', 'février': '02', 'mars': '03', 'avril': '04',
                    'mai': '05', 'juin': '06', 'juillet': '07', 'août': '08',
                    'septembre': '09', 'octobre': '10', 'novembre': '11', 'décembre': '12'
                };
                const formattedDate = `${dateParts[2]}-${months[dateParts[1]]}-${dateParts[0].padStart(2, '0')}`;
                
                // Remplir les champs du formulaire
                document.querySelector('input[name="idKw"]').value = data.idKw.replace('KW', '');
                document.querySelector('input[name="user_name"]').value = data.user_name;
                document.querySelector('input[name="email"]').value = data.email;
                document.querySelector('select[name="pack"]').value = data.pack;
                document.querySelector('input[name="amount"]').value = data.amount.replace('$', '');
                document.querySelector('select[name="payment_system"]').value = data.payment_system;
                document.querySelector('select[name="status"]').value = data.status;
                document.querySelector('input[name="invoice_code"]').value = data.invoice_code;
                document.querySelector('input[name="date"]').value = formattedDate;
                document.querySelector('input[name="time"]').value = data.time;
                
                // Ouvrir le formulaire
                openForm();
            }
        }

        // Fonction pour annuler l'édition
        function cancelEdit() {
            document.getElementById('editId').value = '';
            document.getElementById('formTitle').textContent = 'Ajouter un nouveau paiement';
            document.getElementById('submitText').textContent = 'Ajouter le paiement';
            document.getElementById('cancelEdit').classList.add('hidden');
            document.getElementById('paymentForm').reset();
            closeForm();
        }

        // Fonction pour ouvrir le formulaire
        function openForm() {
            document.getElementById('formContainer').classList.add('open');
        }

        // Fonction pour fermer le formulaire
        function closeForm() {
            document.getElementById('formContainer').classList.remove('open');
        }

        // Gestion des interactions des cartes
        function initCardInteractions() {
            const cards = document.querySelectorAll('.payment-card');
            cards.forEach(card => {
                card.addEventListener('click', function(e) {
                    // Ne pas déclencher le toggle si on clique sur un lien ou un bouton à l'intérieur
                    if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || e.target.closest('a') || e.target.closest('button')) {
                        return;
                    }
                    toggleCard(this);
                });
            });
        }

        function toggleCard(card) {
            const isExpanded = card.classList.contains('expanded');
            
            // Fermer toutes les autres cartes
            document.querySelectorAll('.payment-card.expanded').forEach(otherCard => {
                if (otherCard !== card) {
                    otherCard.classList.remove('expanded');
                }
            });
            
            // Toggle la carte actuelle
            if (isExpanded) {
                card.classList.remove('expanded');
            } else {
                card.classList.add('expanded');
                
                // Scroll smooth vers la carte ouverte
                setTimeout(() => {
                    card.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest'
                    });
                }, 200);
            }
        }

        // Gestion des cases à cocher
        function initCheckboxListeners() {
            // Case à cocher "Tout sélectionner"
            document.getElementById('selectAll').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.row-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                    const id = checkbox.getAttribute('data-id');
                    if (this.checked) {
                        selectedRows.add(id);
                    } else {
                        selectedRows.delete(id);
                    }
                });
                updateButtonStates();
            });
            
            // Cases à cocher individuelles
            document.querySelectorAll('.row-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const id = this.getAttribute('data-id');
                    if (this.checked) {
                        selectedRows.add(id);
                    } else {
                        selectedRows.delete(id);
                        document.getElementById('selectAll').checked = false;
                    }
                    updateButtonStates();
                });
            });
        }

        // Mettre à jour l'état des boutons
        function updateButtonStates() {
            const btnModify = document.getElementById('btnModify');
            const btnDelete = document.getElementById('btnDelete');
            
            if (selectedRows.size === 0) {
                btnModify.classList.add('btn-disabled');
                btnDelete.classList.add('btn-disabled');
            } else {
                btnDelete.classList.remove('btn-disabled');
                
                if (selectedRows.size === 1) {
                    btnModify.classList.remove('btn-disabled');
                } else {
                    btnModify.classList.add('btn-disabled');
                }
            }
        }

        // Gestion du formulaire
        document.getElementById('toggleForm').addEventListener('click', function() {
            cancelEdit(); // Réinitialiser le formulaire
            document.getElementById('formContainer').classList.toggle('open');
        });

        document.getElementById('cancelEdit').addEventListener('click', function() {
            cancelEdit();
        });

        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // Formater l'ID KirooWorld
            data.idKw = `KW${data.idKw}`;
            
            if (document.getElementById('editId').value) {
                updatePayment(data);
            } else {
                addPayment(data);
            }
            this.reset();
        });

        // Gestion des boutons Modifier et Supprimer
        document.getElementById('btnModify').addEventListener('click', function() {
            if (!this.classList.contains('btn-disabled')) {
                prepareEdit();
            }
        });

        document.getElementById('btnDelete').addEventListener('click', function() {
            if (!this.classList.contains('btn-disabled')) {
                deleteSelectedPayments();
            }
        });

        // Fermer le formulaire lorsqu'on clique à l'extérieur
        document.addEventListener('click', function(event) {
            const formContainer = document.getElementById('formContainer');
            const toggleFormBtn = document.getElementById('toggleForm');
            
            // Vérifier si le clic est en dehors du formulaire et du bouton
            if (formContainer.classList.contains('open') && 
                !formContainer.contains(event.target) && 
                event.target !== toggleFormBtn && 
                !toggleFormBtn.contains(event.target)) {
                cancelEdit();
            }
            
            // Fermer les cartes si on clique ailleurs
            if (!event.target.closest('.payment-card')) {
                document.querySelectorAll('.payment-card.expanded').forEach(card => {
                    card.classList.remove('expanded');
                });
            }
        });

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', function() {
            renderData();
        });
    </script>
</body>
</html>